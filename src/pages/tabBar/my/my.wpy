<template>
  <view>
    我的界面
    <view>{{UserInfo.balance}}</view>
    <button bindtap="toMineActivty">我的活动</button>
    <button bindtap="toCoupon">优惠券</button>
    <button bindtap="toPersonalData">个人资料</button>
    <button bindtap="toMineIntergral">我的积分</button>
    <button bindtap="toUpGrade">升等级</button>
    <button bindtap="toFootPrint">足迹</button>
    <button bindtap="toElectricBill">电子账单</button>
    <button bindtap="toAfterSaleCriterion">售后准则</button>
    <button bindtap="toAboutUs">关于我们</button>
    <button @tap="openPopup">功能建设中</button>
    <popup 
      :isShow.sync="isShow" 
      popUpType="center"
      @hide.user="hidePop">
      <view class="underConstruction flex flex-v flex-align-center">
        <text>敬请期待</text>
        <text>为了给你带来更好的体验，我们正在努力测试当中，敬请期待...</text>
        <view class="btn" @tap="hidePop">知道了</view>
      </view>
      </popup>
  </view>
</template>
<script>
import wepy from 'wepy';
import popup from '@components/popup';
import {getUserInfo,register} from "@Api/mine/mineApi";
  //通过继承自wepy.page的类创建页面逻辑
  export default class Index extends wepy.page {
      //可用于页面模板绑定的数据
      data = {
          list: [
            {
              hao: '123'
            }
          ],
          motto: 'Hello World',
          UserInfo: {},
          isShow:false,
      };
      components = {
        popup,
      };
      //事件处理函数(集中保存在methods对象中)
      methods = {
        openPopup() { //弹窗显示
          this.isShow = true;
          this.$apply();
        },
        hidePop() { //弹窗隐藏
          this.isShow = false;
          this.$apply();
        },
        bindViewTap() {
          console.log('button clicked');
        },
        toMineActivty() {
          wx.navigateTo({
            url: '/pages/my/view/mineActivity',
          })
        },
        toCoupon() {
          wx.navigateTo({
            url: '/pages/my/view/coupon',
          })
        },
        toPersonalData() {
          wx.navigateTo({
            url: '/pages/my/view/personalData',
          })
        },
        toMineIntergral() {
          wx.navigateTo({
            url: '/pages/my/view/myIntegral',
          })
        },
        toUpGrade() {
          wx.navigateTo({
            url: '/pages/my/view/UpGrade',
          })
        },
        toFootPrint() {
          wx.navigateTo({
            url: '/pages/my/view/footprint',
          })
        },
        toElectricBill() {
          wx.navigateTo({
            url: '/pages/my/view/electricBill',
          })
        },
        toAfterSaleCriterion() {
          wx.navigateTo({
            url: '/pages/my/view/afterSaleCriterion',
          })
        },
        toAboutUs() {
          wx.navigateTo({
            url: '/pages/my/view/aboutUs',
          })
        }
      };
      //页面的生命周期函数
      async onLoad() {
          let res =await this.register(); //注册
          await this.saveUserInfo(res.data); //保存信息
          // let UserInfo = await this.getUserInfo(); //获取会员信息
          // this.UserInfo = UserInfo;
          this.$apply();
          console.log(this.UserInfo)
      };
      //每次页面进入触发
      async onShow() {
        // this.getUserInfo();
      };
      // 保存信息
      async saveUserInfo(data) {
        let {companyId,shopId,userId,memberId} = data;
        this.$parent.globalData.shopId = shopId;
        this.$parent.globalData.memberId = memberId;
        this.$parent.globalData.userId = userId;
        wepy.setStorageSync("companyId",companyId);
        wepy.setStorageSync("userId",userId);
      };
      // 会员注册
      async register() {
        return { //假设注册成功
          state: 200,
          msg: "OK",
          data: {
            companyId: "7eb47787d95045d79cc8e1dbb71414d5",
            shopId: "3d26ff58746a476a96800fb99911a310",
            userId: "2e3e5de7d5ae48c992f47bd3b89ea90a",
            memberId: "e5512fa1b1d111e8ae9ef48e3888bbef",
          }
        }
      };
      // 获取会员信息
      async getUserInfo() {
        let {shopId,userId,memberId} = this.$parent.globalData;
        let option = {
            shopId: shopId,
            userId: userId,
            memberId: memberId
        }
        let res =await getUserInfo(option)
        // { "state": 200,  "msg": "OK",  "data":{ 返回参数} }
        if(res.msg == 'OK'){
          return res.data;
        }else{
          return {
            couponNum: "0",
            integralNum: "0",
            balance: "0.00",
            qcSrc: "",
            nickName: "",
            faceSrc: "",
            gradeName: "",
            shopName: "",
            member: "",
            sex: "",
            phone: "",
          }
        }
      };
  }
</script>
<style lang="less" scoped>
  .underConstruction{
      width: 519rpx;
      height: 542rpx;
      background-color:#FFF;
      border-radius: 17rpx;
      >text{
        &:first-of-type{
          margin-top: 76rpx;
          font-size: 34rpx;
          color: #333333;
          font-weight: bold;
          line-height: 34rpx;
        }
        &:last-of-type{
          margin-top: 76rpx;
          width: 442rpx;
          font-size: 26rpx;
          color: #999999;
          line-height: 47rpx;
        }
      }
      >view{
        margin-top: 117rpx;
        width: 400rpx;
        height: 76rpx;
        border-radius: 76rpx;
        font-size: 34rpx;
        line-height: 76rpx;
        font-weight: bold;
        text-align: center;
        color: #fff;
        background: -webkit-linear-gradient(left, #FC894F, #FB6F4D);
        /* Safari 5.1 - 6.0 */
        background: -o-linear-gradient(right, #FC894F, #FB6F4D);
        /* Opera 11.1 - 12.0 */
        background: -moz-linear-gradient(right, #FC894F, #FB6F4D);
        /* Firefox 3.6 - 15 */
        background: linear-gradient(to right, #FC894F, #FB6F4D);
        /* 标准的语法 */
      }
  }
</style>
